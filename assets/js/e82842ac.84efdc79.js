"use strict";(self.webpackChunk=self.webpackChunk||[]).push([[232],{3905:(e,t,n)=>{n.d(t,{Zo:()=>u,kt:()=>h});var r=n(7294);function a(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function o(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function i(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?o(Object(n),!0).forEach((function(t){a(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):o(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function s(e,t){if(null==e)return{};var n,r,a=function(e,t){if(null==e)return{};var n,r,a={},o=Object.keys(e);for(r=0;r<o.length;r++)n=o[r],t.indexOf(n)>=0||(a[n]=e[n]);return a}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(r=0;r<o.length;r++)n=o[r],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(a[n]=e[n])}return a}var l=r.createContext({}),p=function(e){var t=r.useContext(l),n=t;return e&&(n="function"==typeof e?e(t):i(i({},t),e)),n},u=function(e){var t=p(e.components);return r.createElement(l.Provider,{value:t},e.children)},c="mdxType",m={inlineCode:"code",wrapper:function(e){var t=e.children;return r.createElement(r.Fragment,{},t)}},d=r.forwardRef((function(e,t){var n=e.components,a=e.mdxType,o=e.originalType,l=e.parentName,u=s(e,["components","mdxType","originalType","parentName"]),c=p(n),d=a,h=c["".concat(l,".").concat(d)]||c[d]||m[d]||o;return n?r.createElement(h,i(i({ref:t},u),{},{components:n})):r.createElement(h,i({ref:t},u))}));function h(e,t){var n=arguments,a=t&&t.mdxType;if("string"==typeof e||a){var o=n.length,i=new Array(o);i[0]=d;var s={};for(var l in t)hasOwnProperty.call(t,l)&&(s[l]=t[l]);s.originalType=e,s[c]="string"==typeof e?e:a,i[1]=s;for(var p=2;p<o;p++)i[p]=n[p];return r.createElement.apply(null,i)}return r.createElement.apply(null,n)}d.displayName="MDXCreateElement"},7368:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>u,contentTitle:()=>l,default:()=>h,frontMatter:()=>s,metadata:()=>p,toc:()=>c});var r=n(7462),a=n(3366),o=(n(7294),n(3905)),i=["components"],s={title:"Upgrade to version 1.5",id:"UPGRADE-1.5"},l=void 0,p={unversionedId:"docs/migration/UPGRADE-1.5",id:"docs/migration/UPGRADE-1.5",title:"Upgrade to version 1.5",description:"Hive snapshot migration",source:"@site/docs/docs/migration/UPGRADE-1.5.md",sourceDirName:"docs/migration",slug:"/docs/migration/UPGRADE-1.5",permalink:"/docs/migration/UPGRADE-1.5",draft:!1,editUrl:"https://github.com/dbt-athena/dbt-athena.github.io/edit/main/docs/docs/migration/UPGRADE-1.5.md",tags:[],version:"current",lastUpdatedAt:1683794895,formattedLastUpdatedAt:"May 11, 2023",frontMatter:{title:"Upgrade to version 1.5",id:"UPGRADE-1.5"},sidebar:"docs",previous:{title:"Known issues",permalink:"/docs/known-issues"},next:{title:"Contributing",permalink:"/docs/contributing/"}},u={},c=[{value:"Hive snapshot migration",id:"hive-snapshot-migration",level:2}],m={toc:c},d="wrapper";function h(e){var t=e.components,n=(0,a.Z)(e,i);return(0,o.kt)(d,(0,r.Z)({},m,n,{components:t,mdxType:"MDXLayout"}),(0,o.kt)("h2",{id:"hive-snapshot-migration"},"Hive snapshot migration"),(0,o.kt)("p",null,"The hive snapshots in dbt-athena v1.4 diverged from the dbt-core implementation.\nIn the v1.5 release, we take the opportunity to review our approach so that we follow the dbt standards.\nUnfortunately, this introduces breaking changes to existing snapshots.\nWe did our best to mitigate the impact on the developer, by printing a detailed error message with migration instructions.\nThe easiest way to migrate your snapshot table is by running ",(0,o.kt)("inlineCode",{parentName:"p"},"dbt snapshot")," one snapshot at a time."),(0,o.kt)("p",null,"Below is a summary of the steps to migrate all your snapshots:"),(0,o.kt)("ol",null,(0,o.kt)("li",{parentName:"ol"},"Install ",(0,o.kt)("inlineCode",{parentName:"li"},"dbt-athena>=1.5")),(0,o.kt)("li",{parentName:"ol"},"Choose a snapshot to migrate. It's probably best to start with one of the least important ones first."),(0,o.kt)("li",{parentName:"ol"},"Run ",(0,o.kt)("inlineCode",{parentName:"li"},"dbt snapshot SNAPSHOT_NAME"),". This command should fail, and print a large error message with a migration query. Scroll up the stdout output until you find the same query again, but without the log timestamps."),(0,o.kt)("li",{parentName:"ol"},"Go to Athena and run the queries one by one. Please double-check each query to make sure that it does what it needs to do. The queries perform the following steps:",(0,o.kt)("ul",{parentName:"li"},(0,o.kt)("li",{parentName:"ul"},"Take a backup of the original table. You never know."),(0,o.kt)("li",{parentName:"ul"},"Run the necessary transformations for the migration and store the results in a temporary table."),(0,o.kt)("li",{parentName:"ul"},"Drop the original table."),(0,o.kt)("li",{parentName:"ul"},"Copy the temporary table results to the original table."),(0,o.kt)("li",{parentName:"ul"},"Drop the temporary table."))),(0,o.kt)("li",{parentName:"ol"},"Check the results of the migrated table. Run some sanity checks to see if it behaves correctly."),(0,o.kt)("li",{parentName:"ol"},"(Optional) Run ",(0,o.kt)("inlineCode",{parentName:"li"},"dbt snapshot SNAPSHOT_NAME")," again. This time there should be no error anymore."),(0,o.kt)("li",{parentName:"ol"},"Repeat steps 2-6 for all your snapshots."),(0,o.kt)("li",{parentName:"ol"},"(Optional) Run ",(0,o.kt)("inlineCode",{parentName:"li"},"dbt snapshot")," to make sure that all your snapshots are migrated."),(0,o.kt)("li",{parentName:"ol"},"(Optional) After a couple of dbt runs, you can clean up the backup tables.")))}h.isMDXComponent=!0}}]);